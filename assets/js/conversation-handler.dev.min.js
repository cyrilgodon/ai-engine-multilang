(()=>{(function(){"use strict";var p,m,b,v,w;const s=((p=window.eaiMLData)==null?void 0:p.pluginVersion)||"1.0.0",l=((m=window.eaiMLData)==null?void 0:m.isDebug)||!1,a=((b=window.eaiMLData)==null?void 0:b.currentLang)||"fr",u=((v=window.eaiMLData)==null?void 0:v.translations)||{},i=((w=window.eaiMLData)==null?void 0:w.localStorageKey)||"eai_ml_last_language",d="eai_ml_lang_alert_cooldown",h=5*60*1e3,t={info:(...e)=>{l&&console.log(`[AI Engine Multilang v${s}]`,...e)},warn:(...e)=>{l&&console.warn(`[AI Engine Multilang v${s}]`,...e)},error:(...e)=>{console.error(`[AI Engine Multilang v${s}]`,...e)}};function y(){try{const o=Object.keys(localStorage).filter(n=>n.startsWith("mwai-"));return o.length>0?(t.info("Active conversation detected:",o),!0):(t.info("No active conversation found"),!1)}catch(e){return t.error("Error checking active conversation:",e),!1}}function L(){try{const e=localStorage.getItem(d);if(!e)return!1;const o=Date.now(),n=parseInt(e,10)-o;return n>0?(t.info(`Cooldown active: ${Math.round(n/1e3)}s remaining`),!0):(localStorage.removeItem(d),!1)}catch(e){return t.error("Error checking cooldown:",e),!1}}function g(){try{const e=Date.now()+h;localStorage.setItem(d,e.toString()),t.info(`Cooldown activated until ${new Date(e).toLocaleTimeString()}`)}catch(e){t.error("Error activating cooldown:",e)}}function x(){const e=u[a]||u.fr||{};return{title:e.title||"Language change detected",message:e.message||"You changed the language. Please start a new conversation.",btnNewConv:e.btnNewConv||"Start new conversation",btnFinishCurr:e.btnFinishCurr||"Finish current one"}}function k(){t.info("Restarting conversation...");try{const e=[".mwai-chatbot .mwai-clear-button",".mwai-chatbot .mwai-reset-button",'.mwai-chatbot button[aria-label*="clear"]','.mwai-chatbot button[aria-label*="restart"]'];let o=null;for(const n of e)if(o=document.querySelector(n),o){t.info("Clear button found with selector:",n);break}if(o)o.click(),t.info("Clear button clicked");else{t.warn("Clear button not found, fallback: clear input field only");const n=document.querySelector('.mwai-chatbot input[type="text"], .mwai-chatbot textarea');n&&(n.value="",t.info("Input field cleared (fallback)"))}localStorage.setItem(i,a),t.info(`Last language updated to: ${a}`)}catch(e){t.error("Error restarting conversation:",e)}}function E(){const e=x(),o=`
			<div id="eai-ml-popup-overlay" style="
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				z-index: 999999;
				display: flex;
				align-items: center;
				justify-content: center;
			">
				<div id="eai-ml-popup" style="
					background: white;
					border-radius: 12px;
					padding: 30px;
					max-width: 500px;
					width: 90%;
					box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
					font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
				">
					<h2 style="
						margin: 0 0 15px 0;
						font-size: 22px;
						font-weight: 600;
						color: #1a1a1a;
					">${e.title}</h2>
					<p style="
						margin: 0 0 25px 0;
						font-size: 16px;
						line-height: 1.5;
						color: #4a4a4a;
					">${e.message}</p>
					<div style="
						display: flex;
						gap: 12px;
						justify-content: flex-end;
					">
						<button id="eai-ml-btn-finish" style="
							background: #f5f5f5;
							border: none;
							border-radius: 6px;
							padding: 12px 20px;
							font-size: 15px;
							font-weight: 500;
							color: #4a4a4a;
							cursor: pointer;
							transition: background 0.2s;
						">${e.btnFinishCurr}</button>
						<button id="eai-ml-btn-restart" style="
							background: #007aff;
							border: none;
							border-radius: 6px;
							padding: 12px 20px;
							font-size: 15px;
							font-weight: 500;
							color: white;
							cursor: pointer;
							transition: background 0.2s;
						">${e.btnNewConv}</button>
					</div>
				</div>
			</div>
		`;document.body.insertAdjacentHTML("beforeend",o);const n=document.getElementById("eai-ml-btn-finish"),r=document.getElementById("eai-ml-btn-restart"),c=document.getElementById("eai-ml-popup-overlay");n.addEventListener("click",()=>{t.info("User chose to finish current conversation"),g(),c.remove()}),r.addEventListener("click",()=>{t.info("User chose to restart conversation"),k(),c.remove()}),c.addEventListener("click",S=>{S.target===c&&(t.info("Popup closed by clicking overlay"),g(),c.remove())}),n.addEventListener("mouseenter",()=>{n.style.background="#e8e8e8"}),n.addEventListener("mouseleave",()=>{n.style.background="#f5f5f5"}),r.addEventListener("mouseenter",()=>{r.style.background="#0056b3"}),r.addEventListener("mouseleave",()=>{r.style.background="#007aff"}),t.info("Popup displayed")}function I(){t.info("Detecting language change...",{currentLang:a,lastLang:localStorage.getItem(i)});try{const e=localStorage.getItem(i);if(!e){t.info("First visit, storing current language:",a),localStorage.setItem(i,a);return}if(e===a){t.info("No language change detected");return}if(t.info(`Language change detected: ${e} \u2192 ${a}`),L()){t.info("Cooldown active, skipping popup");return}if(!y()){t.info("No active conversation, silent language change"),localStorage.setItem(i,a);return}E()}catch(e){t.error("Error detecting language change:",e)}}function f(){if(t.info("Initializing...",{version:s,currentLang:a,isDebug:l}),!window.eaiMLData){t.error("eaiMLData not found! Plugin may not work correctly.");return}I(),t.info("Initialization complete")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f()})();})();
